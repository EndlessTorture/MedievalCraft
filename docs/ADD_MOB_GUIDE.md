# Гайд по добавлению мобов в MedievalCraft

Этот гайд описывает процесс добавления нового моба в игру — от создания модели до реализации сложного поведения.

---

## 1. Подготовка ресурсов

### Модель и форматы
- **.gltf / .glb** (Рекомендуется). Единственный формат, поддерживающий **скелетную анимацию**.
- **.obj** (Для статики). Поддерживает только геометрию и текстуру, без анимаций.

Поместите файл модели в: `assets/models/ваша_модель.gltf`

### UV-развёртка (Важно!)
Наш движок использует **один материал и одну текстуру** на каждого моба.
1. При моделировании в Blender/Blockbench убедитесь, что все части тела развернуты на **одну общую текстурную карту (Atlas)**.
2. Модель **обязательно** должна содержать UV-координаты. 
3. Текстура должна быть в формате **PNG**.

Поместите текстуру в: `assets/textures/entity/ваша_текстура.png`

---

## 2. Создание класса моба

Создайте новый файл в `src/entities/mobs/`, например `Knight.js`.

```javascript
import { PeacefulMob } from '../PeacefulMob.js';
import { KnightAI } from '../ai/KnightAI.js'; // Если создаете свой ИИ

export class Knight extends PeacefulMob {
    constructor(x, y, z, model) {
        super(x, y, z, model);
        
        this.width = 0.4; 
        this.height = 1.8;
        
        // Переопределяем ИИ, если нужно
        this.ai = new KnightAI(); 
        
        // Устанавливаем начальную анимацию
        this.setAnimation(['idle', 'stay']);
    }
}
```

---

## 3. Работа с анимациями

Движок MedievalCraft автоматически ищет анимации в вашем файле модели по именам.

### Как запустить анимацию:
Метод `mob.setAnimation(names)` принимает массив имен. Он включит первую найденную в файле анимацию из списка:
```javascript
// Попробует найти 'walk', если нет - 'run', если нет - 'walking'
this.setAnimation(['walk', 'run', 'walking']);
```

### Стандартные имена (Best Practice):
Для совместимости с существующим ИИ рекомендуется называть анимации в модели следующими именами:
- `walk` или `run` — для движения.
- `idle` — для состояния покоя.
- `attack` — для боя.

---

## 4. Создание собственного ИИ (Behavior AI)

ИИ в игре — это простой класс с методом `update(mob, dt)`.

```javascript
export class AggressiveAI {
    constructor() {
        this.timer = 0;
    }

    update(mob, dt) {
        // mob - это экземпляр вашего моба
        // dt - время с прошлого кадра (в секундах)

        // Пример: заставить моба всегда идти вперед
        mob.vx = Math.sin(mob.yaw) * 1.5;
        mob.vz = Math.cos(mob.yaw) * 1.5;
        
        // Включаем анимацию бега
        mob.setAnimation(['run', 'walk']);
    }
}
```

Назначить ИИ мобу можно в конструкторе: `this.ai = new MyCustomAI();`

---

## 5. Регистрация в MobManager

Откройте `src/entities/MobManager.js` и добавьте моба в список типов:

```javascript
import { Knight } from './mobs/Knight.js';

// ... в конструкторе:
this.mobTypes = [
    { 
        id: 'knight', 
        class: Knight, 
        modelPath: 'assets/models/knight.gltf', 
        texturePath: 'assets/textures/entity/knight_texture.png' 
    }
];
```

---

## Тонкости и советы

1.  **Центральная точка (Pivot)**: В 3D-редакторе ставьте "ноги" моба в координату `0, 0, 0`. Если центр модели будет в животе, моб будет спавниться наполовину в земле.
2.  **Скелет (Кости)**: 
    - Максимальное количество костей на одну модель: **64**.
    - Каждая вершина может быть привязана максимум к **4 костям** (стандарт GLTF).
3.  **Производительность**: 
    - Старайтесь держать количество полигонов в пределах **1000-3000** для обычных мобов.
    - Один моб — одна текстура. Это позволяет движку рисовать их очень быстро.
4.  **Отладка**: Если моб не появился, проверьте консоль браузера (F12). Скорее всего, там будет ошибка пути к файлу или ошибка парсинга модели.
